TCPDUMP

sun# tcpdump -i eth0 -w /tmp/tcpdump.log &

PRE-TEST

Starting strongSwan 5.5.1 IPsec [starter]...
no netkey IPsec stack detected
no KLIPS IPsec stack detected
no known IPsec stack detected, ignoring!
Starting strongSwan 5.5.1 IPsec [starter]...
no netkey IPsec stack detected
no KLIPS IPsec stack detected
no known IPsec stack detected, ignoring!
50
50
initiating IKE_SA host-host[1] to 192.168.0.2
generating IKE_SA_INIT request 0 [ SA KE No N(NATD_S_IP) N(NATD_D_IP) N(FRAG_SUP) N(HASH_ALG) N(REDIR_SUP) ]
sending packet: from 192.168.0.1[500] to 192.168.0.2[500] (1156 bytes)
received packet: from 192.168.0.2[500] to 192.168.0.1[500] (617 bytes)
parsed IKE_SA_INIT response 0 [ SA KE No N(NATD_S_IP) N(NATD_D_IP) CERTREQ N(FRAG_SUP) N(HASH_ALG) N(MULT_AUTH) ]
received cert request for "C=CH, O=Linux strongSwan, CN=strongSwan Root CA"
sending cert request for "C=CH, O=Linux strongSwan, CN=strongSwan Root CA"
authentication of 'moon.strongswan.org' (myself) with RSA_EMSA_PKCS1_SHA2_256 successful
sending end entity cert "C=CH, O=Linux strongSwan, CN=moon.strongswan.org"
establishing CHILD_SA host-host
generating IKE_AUTH request 1 [ IDi CERT N(INIT_CONTACT) CERTREQ IDr AUTH N(USE_TRANSP) N(ESP_TFC_PAD_N) SA TSi TSr N(MOBIKE_SUP) N(ADD_4_ADDR) N(ADD_6_ADDR) N(ADD_6_ADDR) N(EAP_ONLY) ]
splitting IKE message with length of 1744 bytes into 2 fragments
generating IKE_AUTH request 1 [ EF(1/2) ]
generating IKE_AUTH request 1 [ EF(2/2) ]
sending packet: from 192.168.0.1[4500] to 192.168.0.2[4500] (1236 bytes)
sending packet: from 192.168.0.1[4500] to 192.168.0.2[4500] (580 bytes)
received packet: from 192.168.0.2[4500] to 192.168.0.1[4500] (1236 bytes)
parsed IKE_AUTH response 1 [ EF(1/2) ]
received fragment #1 of 2, waiting for complete IKE message
received packet: from 192.168.0.2[4500] to 192.168.0.1[4500] (452 bytes)
parsed IKE_AUTH response 1 [ EF(2/2) ]
received fragment #2 of 2, reassembling fragmented IKE message
parsed IKE_AUTH response 1 [ IDr CERT AUTH N(USE_TRANSP) N(ESP_TFC_PAD_N) SA TSi TSr N(AUTH_LFT) N(MOBIKE_SUP) N(ADD_4_ADDR) N(ADD_6_ADDR) N(ADD_6_ADDR) ]
received end entity cert "C=CH, O=Linux strongSwan, CN=sun.strongswan.org"
  using certificate "C=CH, O=Linux strongSwan, CN=sun.strongswan.org"
  using trusted ca certificate "C=CH, O=Linux strongSwan, CN=strongSwan Root CA"
checking certificate status of "C=CH, O=Linux strongSwan, CN=sun.strongswan.org"
  fetching crl from 'http://crl.strongswan.org/strongswan.crl' ...
unable to fetch from http://crl.strongswan.org/strongswan.crl, no capable fetcher found
crl fetching failed
certificate status is not available
  reached self-signed root ca with a path length of 0
authentication of 'sun.strongswan.org' with RSA_EMSA_PKCS1_SHA2_256 successful
IKE_SA host-host[1] established between 192.168.0.1[moon.strongswan.org]...192.168.0.2[sun.strongswan.org]
scheduling reauthentication in 10154s
maximum IKE_SA lifetime 10694s
received ESP_TFC_PADDING_NOT_SUPPORTED, not using ESPv3 TFC padding
CHILD_SA host-host{1} established with SPIs cf6e1213_i c12ffc43_o and TS 192.168.0.1/32 === 192.168.0.2/32
updown: /usr/local/libexec/ipsec/_updown: iptables: not found
updown: /usr/local/libexec/ipsec/_updown: iptables: not found
received AUTH_LIFETIME of 10210s, scheduling reauthentication in 9670s
peer supports MOBIKE
connection 'host-host' established successfully

TEST

moon# ipsec status 2> /dev/null | grep 'host-host.*ESTABLISHED.*moon.strongswan.org.*sun.strongswan.org' [YES]
   host-host[1]: ESTABLISHED 11 seconds ago, 192.168.0.1[moon.strongswan.org]...192.168.0.2[sun.strongswan.org]

sun# ipsec status 2> /dev/null | grep 'host-host.*ESTABLISHED.*sun.strongswan.org.*moon.strongswan.org' [YES]
   host-host[1]: ESTABLISHED 11 seconds ago, 192.168.0.2[sun.strongswan.org]...192.168.0.1[moon.strongswan.org]

moon# ipsec status 2> /dev/null | grep 'host-host.*INSTALLED, TRANSPORT' [YES]
   host-host{1}:  INSTALLED, TRANSPORT, reqid 1, AH SPIs: cf6e1213_i c12ffc43_o

sun# ipsec status 2> /dev/null | grep 'host-host.*INSTALLED, TRANSPORT' [YES]
   host-host{1}:  INSTALLED, TRANSPORT, reqid 1, AH SPIs: c12ffc43_i cf6e1213_o

moon# ping -c 1 192.168.0.2 | grep '64 bytes from 192.168.0.2: icmp_.eq=' [YES]
64 bytes from 192.168.0.2: icmp_seq=0 ttl=64 time=1.976 ms

sun# killall tcpdump

reading from file /tmp/tcpdump.log, link-type EN10MB (Ethernet)
sun# tcpdump -r /tmp/tcpdump.log | grep 'IP 192.168.0.1 > 192.168.0.2: AH' [YES]
13:56:02.617404 IP 192.168.0.1 > 192.168.0.2: AH(spi=0xc12ffc43,seq=0x1): ICMP echo request, id 19055, seq 0, length 64

reading from file /tmp/tcpdump.log, link-type EN10MB (Ethernet)
sun# tcpdump -r /tmp/tcpdump.log | grep 'IP 192.168.0.2 > 192.168.0.1: AH' [YES]
13:56:02.618210 IP 192.168.0.2 > 192.168.0.1: AH(spi=0xcf6e1213,seq=0x1): ICMP echo reply, id 19055, seq 0, length 64


POST-TEST

Stopping strongSwan IPsec...
Stopping strongSwan IPsec...
sun# killall tcpdump

